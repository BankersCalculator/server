<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DSR 계산기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">DSR 계산기</h1>
    <form th:action="@{/dsrCalc}" th:object="${dsrCalcRequest}" method="post">
        <div class="mb-3">
            <label for="annualIncome" class="form-label">연간 소득</label>
            <input type="number" class="form-control" id="annualIncome" th:field="*{annualIncome}" required>
        </div>

        <div id="loanContainer">
            <div class="loan-item mb-4" th:each="loan, stat : *{loanStatusList}">
                <h4>대출 #<span th:text="${stat.count}"></span></h4>
                <div class="mb-3">
                    <label th:for="${'repaymentType' + stat.index}" class="form-label">상환 유형</label>
                    <select th:id="${'repaymentType' + stat.index}" th:field="*{loanStatusList[__${stat.index}__].repaymentType}" class="form-select">
                        <option th:each="type : ${T(com.myZipPlan.server.common.enums.RepaymentType).values()}"
                                th:value="${type}" th:text="${type.description}"></option>
                    </select>
                </div>
                <div class="mb-3">
                    <label th:for="${'loanType' + stat.index}" class="form-label">대출 유형</label>
                    <select th:id="${'loanType' + stat.index}" th:field="*{loanStatusList[__${stat.index}__].loanType}" class="form-select">
                        <option th:each="type : ${T(com.myZipPlan.server.common.enums.LoanType).values()}"
                                th:value="${type}" th:text="${type.description}"></option>
                    </select>
                </div>
                <div class="mb-3">
                    <label th:for="${'principal' + stat.index}" class="form-label">원금</label>
                    <input type="number" th:id="${'principal' + stat.index}" th:field="*{loanStatusList[__${stat.index}__].principal}" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label th:for="${'maturityPaymentAmount' + stat.index}" class="form-label">만기 상환금</label>
                    <input type="number" th:id="${'maturityPaymentAmount' + stat.index}" th:field="*{loanStatusList[__${stat.index}__].maturityPaymentAmount}" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label th:for="${'term' + stat.index}" class="form-label">기간 (개월)</label>
                    <input type="number" th:id="${'term' + stat.index}" th:field="*{loanStatusList[__${stat.index}__].term}" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label th:for="${'gracePeriod' + stat.index}" class="form-label">거치 기간 (개월)</label>
                    <input type="number" th:id="${'gracePeriod' + stat.index}" th:field="*{loanStatusList[__${stat.index}__].gracePeriod}" class="form-control">
                </div>
                <div class="mb-3">
                    <label th:for="${'interestRate' + stat.index}" class="form-label">이자율 (%)</label>
                    <input type="number" step="0.01" th:id="${'interestRate' + stat.index}" th:field="*{loanStatusList[__${stat.index}__].interestRatePercentage}" class="form-control" required>
                </div>
            </div>
        </div>

        <button type="button" id="addLoanBtn" class="btn btn-secondary mb-3">대출 추가</button>
        <button type="submit" class="btn btn-primary">DSR 계산</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const addLoanBtn = document.getElementById('addLoanBtn');
        const loanContainer = document.getElementById('loanContainer');
        let loanCount = /*[[${dsrCalcRequest.loanStatusList.size()}]]*/ 0;

        addLoanBtn.addEventListener('click', function() {
            const newLoan = document.createElement('div');
            newLoan.className = 'loan-item mb-4';
            newLoan.innerHTML = `
                    <h4>대출 #${loanCount + 1}</h4>
                    <div class="mb-3">
                        <label for="repaymentType${loanCount}" class="form-label">상환 유형</label>
                        <select id="repaymentType${loanCount}" name="loanStatusList[${loanCount}].repaymentType" class="form-select">
                            <option value="BULLET">일시상환</option>
                            <option value="AMORTIZING">원리금균등분할상환</option>
                            <option value="EQUAL_PRINCIPAL">원금균등분할상환</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="loanType${loanCount}" class="form-label">대출 유형</label>
                        <select id="loanType${loanCount}" name="loanStatusList[${loanCount}].loanType" class="form-select">
                            <option value="MORTGAGE">주택담보대출</option>
                            <option value="INTERIM_PAYMENT_AND_MOVING">중도금 및 이주비</option>
                            <option value="OFFICETEL_MORTGAGE_LOAN">오피스텔담보대출</option>
                            <option value="JEONSE_LOAN">전세대출</option>
                            <option value="JEONSE_DEPOSIT_COLLATERAL_LOAN">전세보증금담보대출</option>
                            <option value="PERSONAL_LOAN">신용대출</option>
                            <option value="NON_HOUSING_REAL_ESTATE_COLLATERAL_LOAN">비주택 부동산 담보 대출</option>
                            <option value="OTHER_COLLATERAL_LOAN">기타담보 대출</option>
                            <option value="DEPOSIT_AND_INSURANCE_COLLATERAL_LOAN">예적금 담보 및 보험계약 대출</option>
                            <option value="SECURITIES_COLLATERAL_LOAN">유가증권 담보대출</option>
                            <option value="LONG_TERM_CARD_LOAN">장기카드대출</option>
                            <option value="OTHER_LOAN">기타대출</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="principal${loanCount}" class="form-label">원금</label>
                        <input type="number" id="principal${loanCount}" name="loanStatusList[${loanCount}].principal" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="maturityPaymentAmount${loanCount}" class="form-label">만기 상환금</label>
                        <input type="number" id="maturityPaymentAmount${loanCount}" name="loanStatusList[${loanCount}].maturityPaymentAmount" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="term${loanCount}" class="form-label">기간 (개월)</label>
                        <input type="number" id="term${loanCount}" name="loanStatusList[${loanCount}].term" class="form-control" required>
                    </div>
                    <div class="mb-3">
                        <label for="gracePeriod${loanCount}" class="form-label">거치 기간 (개월)</label>
                        <input type="number" id="gracePeriod${loanCount}" name="loanStatusList[${loanCount}].gracePeriod" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label for="interestRate${loanCount}" class="form-label">이자율 (%)</label>
                        <input type="number" step="0.01" id="interestRate${loanCount}" name="loanStatusList[${loanCount}].interestRatePercentage" class="form-control" required>
                    </div>
                `;
            loanContainer.appendChild(newLoan);
            loanCount++;
        });
    });
</script>
</body>
</html>