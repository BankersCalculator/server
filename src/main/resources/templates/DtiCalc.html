<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>DTI Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .container {
            width: 80%;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }
        h1 {
            text-align: center;
        }
        .description {
            margin-bottom: 20px;
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
        }
        .description p {
            margin: 0;
        }
        .formula {
            text-align: center;
            font-weight: bold;
            margin: 20px 0;
        }
        .form-group {
            margin-bottom: 15px;
            position: relative;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center; /* Center align all form groups */
        }
        label {
            display: block;
            width: 50%; /* Match width of input-container and buttons */
            margin-bottom: 5px;
            text-align: left; /* Left align labels */
        }
        .input-container {
            display: inline-flex;
            align-items: center;
            width: 50%; /* Adjusted to 50% width to accommodate unit */
            margin-bottom: 5px;
        }
        input[type="number"], input[type="text"], input[type="date"], select {
            width: 100%; /* Adjusted to 100% width of the container */
            padding: 8px;
            box-sizing: border-box;
            text-align: right; /* Right align text */
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0; /* Remove up/down arrows for Webkit browsers */
        }
        input::placeholder {
            color: #ccc;
        }
        .form-group .unit {
            margin-left: 5px;
            color: #888;
        }
        .form-group .buttons {
            display: flex;
            justify-content: flex-start; /* Align buttons to the start */
            width: 50%; /* Match the width of the input */
            gap: 2%; /* Add gap between buttons */
        }
        .buttons button {
            flex: 1; /* Allow buttons to take up equal space */
            padding: 8px;
            cursor: pointer;
        }
        button.calculate, button.reset {
            display: block;
            width: 50%;
            padding: 10px;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            margin: 20px auto; /* Center align the buttons */
        }
        button.calculate {
            background-color: #007bff;
        }
        button.calculate:hover {
            background-color: #0056b3;
        }
        button.reset {
            background-color: #6c757d;
        }
        button.reset:hover {
            background-color: #5a6268;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e9ecef;
            text-align: center; /* Center align the result */
        }
        .section-title {
            font-size: 1.5em;
            margin-top: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }
        .formatted-value {
            font-size: 0.9em;
            color: #888;
            text-align: right; /* Left align formatted values */
            width: 50%; /* Match width of input-container */
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>💰DTI 계산기🏠</h1>
        <div class="description">
            <p> 👉 DTI (Debt to Income ratio, 총부채상환비율)는 주택담보대출 차주의 원리금상환능력을 감안하여 주택담보대출 한도를 설정하기 위해 도입된 규제 비율입니다.
                이는 LTV 규제 강화의 후속조치로 2005년 8월 도입되었으며, 이는 차주의 소득수준과 관계없이 주택가격에 비례하여 주택담보대출 한도가 결정되는 LTV 규제의 문제점을 보완하고자 도입된 것입니다. 
                예를 들어 저금리 하에서 주택가격 상승세가 확대될 경우 DTI 및 LTV 규제를 강화하면 주택담보대출 한도가 축소되어 주택시장 과열을 억제하는 효과를 기대할 수 있습니다. <br>
                [한국은행, 경제용어사전 발췌]<br>
            </p>
        </div>
        <div class="formula">
            🏦 DTI = (해당 주택담보대출의 연간 원리금 상환액 + 기타부채의 연간 이자상환액) / 연소득 × 100 <br>[은행업 감독규정]
        </div>
        <form th:action="@{/dti/result}" th:object="${dtiCalcRequest}" method="post">
            <div class="form-group">
                <label>연소득 (세전, 증빙가능한 소득기준)</label>
                <div class="input-container">
                    <input type="number" th:field="*{annualIncome}" id="annualIncome" placeholder="0" onfocus="this.placeholder=''" onblur="this.placeholder='0'" oninput="updateFormattedValue(this, 'formatted-annualIncome')" required />
                    <span class="unit">원</span>
                </div>
                <div class="buttons">
                    <button type="button" onclick="adjustValue('annualIncome', 1000000)">+100만</button>
                    <button type="button" onclick="adjustValue('annualIncome', 10000000)">+1000만</button>
                    <button type="button" onclick="adjustValue('annualIncome', 100000000)">+1억</button>
                </div>
                <div class="formatted-value" id="formatted-annualIncome">0원</div>
            </div>
            <div class="form-group">
                <label>주택 구매에 필요하신 금액을 입력해주세요(대출금액)</label>
                <div class="input-container">
                    <input type="number" th:field="*{loanStatusList[0].principal}" id="principal" placeholder="0" onfocus="this.placeholder=''" onblur="this.placeholder='0'" oninput="updateFormattedValue(this, 'formatted-principal')" />
                    <span class="unit">원</span>
                </div>
                <div class="buttons">
                    <button type="button" onclick="adjustValue('principal', 1000000)">+100만</button>
                    <button type="button" onclick="adjustValue('principal', 10000000)">+1000만</button>
                    <button type="button" onclick="adjustValue('principal', 100000000)">+1억</button>
                </div>
                <div class="formatted-value" id="formatted-principal">0원</div>
            </div>
			<div class="form-group">
			    <label>대출유형을 선택해주세요</label>
			    	<select th:field="*{loanStatusList[0].loanType}" style="width: 50%;">
					<option value="MORTGAGE">주택담보대출</option>
					<option value="INTERIM_PAYMENT_AND_MOVING">중도금 및 이주비</option>
					<option value="OFFICETEL_MORTGAGE_LOAN">오피스텔담보대출</option>
				    <option value="JEONSE_LOAN">전세대출</option>
				    <option value="JEONSE_DEPOSIT_COLLATERAL_LOAN">전세보증금담보대출</option>
				    <option value="PERSONAL_LOAN">신용대출</option>
				    <option value="NON_HOUSING_REAL_ESTATE_COLLATERAL_LOAN">비주택 부동산 담보 대출</option>
				    <option value="OTHER_COLLATERAL_LOAN">기타담보 대출</option>
				    <option value="DEPOSIT_AND_INSURANCE_COLLATERAL_LOAN">예적금 담보 및 보험계약 대출</option>
					<option value="SECURITIES_COLLATERAL_LOAN">유가증권 담보대출</option>
					<option value="LONG_TERM_CARD_LOAN">장기카드대출</option>
					<option value="OTHER_LOAN">기타대출</option>
			        </select>
			</div>
			<div class="form-group">
                <label>매달 납부하실 방법을 선택해주세요(상환방식)</label>
                <select th:field="*{loanStatusList[0].repaymentType}" style="width: 50%;">
					<option value="BULLET">일시상환</option>
					<option value="AMORTIZING">원리금균등분할상환</option>
					<option value="EQUAL_PRINCIPAL">원금균등분할상환</option>
                </select>
            </div>
            <div class="form-group">
                <label>대출 기간을 입력해주세요</label>
                <div class="input-container">
                    <input type="number" th:field="*{loanStatusList[0].term}" id="term" placeholder="0" onfocus="this.placeholder=''" onblur="this.placeholder='0'" oninput="updateFormattedValue(this, 'formatted-term')" />
                    <span class="unit">개월</span>
                </div>
                <div class="buttons">
                    <button type="button" onclick="adjustValue('term', 12)">+1년</button>
                    <button type="button" onclick="adjustValue('term', 60)">+5년</button>
                    <button type="button" onclick="adjustValue('term', 120)">+10년</button>
                </div>
            </div>
            <div class="form-group">
                <label>이자율</label>
                <div class="input-container">
                    <input type="number" step="0.01" th:field="*{loanStatusList[0].interestRatePercentage}" id="interestRatePercentage" placeholder="0" onfocus="this.placeholder=''" onblur="this.placeholder='0'" oninput="formatPercentage(this)" />
                    <span class="unit">%</span>
                </div>
                <div class="formatted-value" id="formatted-interestRatePercentage">0%</div>
            </div>
            <button type="submit" class="calculate">Calculate</button>
            <button type="button" class="reset" onclick="resetForm()">초기화</button>
        </form>
		<div class="result" th:if="${dtiCalcResponse != null}">
		    <h2>결과</h2>
			    <p th:text="'주택담보대출 ' + ${#numbers.formatInteger(dtiCalcResponse.dtiCalcResultList[0].principal, 1, 'COMMA')} + '원의 경우'"></p>
			    <p th:text="'(' + ${dtiCalcResponse.dtiCalcResultList[0].term} + '년' + ', 원리금균등 기준)'"></p>
			    <p th:text="'연소득은 ' + ${#numbers.formatInteger(dtiCalcResponse.annualIncome, 1, 'COMMA')} + '원이므로'"></p>
			    <p th:text="'DTI는 약 ' + ${#numbers.formatInteger(dtiCalcResponse.finalDtiRatio, 2, 'COMMA' )} + '%로 예상됩니다.'"></p>
                <p class="section-title">연원금 상환액</p>
                <p th:text="${#numbers.formatInteger(dtiCalcResponse.dtiCalcResultList[0].annualPrincipalRepayment,1,'COMMA')} + '원'"></p>
                <p class="section-title">연이자 상환액</p>
			    <p th:text="${#numbers.formatInteger(dtiCalcResponse.dtiCalcResultList[0].annualInterestRepayment,1,'COMMA')} + '원'"></p>
			    <p class="section-title">연소득</p>
			    <p th:text="${#numbers.formatInteger(dtiCalcResponse.annualIncome,1,'COMMA')} + '원'"></p>
			    <p class="section-title">DTI</p>
			    <p th:text="${#numbers.formatInteger(dtiCalcResponse.finalDtiRatio,2,'COMMA')} + '%'"></p>
        </div>
    </div>
    <script>
        function adjustValue(id, amount) {
            var input = document.getElementById(id);
            input.value = parseInt(input.value || 0) + amount;
            updateFormattedValue(input, 'formatted-' + id);
        }

        function resetForm() {
            document.querySelectorAll('input[type="number"], input[type="text"], input[type="date"], select').forEach(input => {
                input.value = '';
                input.placeholder = '0';
            });
            document.querySelectorAll('.formatted-value').forEach(el => el.textContent = '0원');
        }

        function formatCurrency(value) {
            var formattedValue = '';
            if (value >= 100000000) {
                var eok = Math.floor(value / 100000000);
                var remainder = value % 100000000;
                var man = Math.floor(remainder / 10000);
                if (man > 0) {
                    formattedValue = eok + '억 ' + man + '만원';
                } else {
                    formattedValue = eok + '억원';
                }
            } else if (value >= 10000) {
                var man = Math.floor(value / 10000);
                var rest = value % 10000;
                formattedValue = man + '만원';
            } else {
                formattedValue = value.toLocaleString() + '원';
            }
            return formattedValue;
        }

        function updateFormattedValue(input, formattedValueId) {
            var value = parseInt(input.value.replace(/,/g, '')) || 0;
            var formattedValue = formatCurrency(value);
            document.getElementById(formattedValueId).textContent = formattedValue;
        }

        function formatPercentage(input) {
            var value = parseFloat(input.value) || 0;
            document.getElementById('formatted-' + input.id).textContent = value.toFixed(2) + '%';
        }
    </script>
</body>
</html>